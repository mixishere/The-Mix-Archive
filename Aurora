(function () {
    // üñ±Ô∏è Make viewers draggable only from edges
    function makeDraggable(el) {
        let isDragging = false, offsetX, offsetY;

        el.addEventListener("mousedown", (e) => {
            const bounds = el.getBoundingClientRect();
            const edgeSize = 10;

            const isNearLeft = e.clientX - bounds.left <= edgeSize;
            const isNearRight = bounds.right - e.clientX <= edgeSize;
            const isNearTop = e.clientY - bounds.top <= edgeSize;
            const isNearBottom = bounds.bottom - e.clientY <= edgeSize;

            if (isNearLeft || isNearRight || isNearTop || isNearBottom) {
                isDragging = true;
                offsetX = e.clientX - el.offsetLeft;
                offsetY = e.clientY - el.offsetTop;
                el.style.cursor = "move";
            }
        });

        document.addEventListener("mouseup", () => {
            isDragging = false;
            el.style.cursor = "default";
        });

        document.addEventListener("mousemove", (e) => {
            if (isDragging) {
                el.style.left = (e.clientX - offsetX) + "px";
                el.style.top = (e.clientY - offsetY) + "px";
            }
        });
    }

    // Create or reuse the Aurora tab bar
    let tabBar = document.getElementById("auroraTabs");
    if (!tabBar) {
        tabBar = document.createElement("div");
        tabBar.id = "auroraTabs";
        tabBar.style = `
            position: fixed; top: 80px; left: 0; width: 80px;
            background: #0d0d0d; padding-top: 20px;
            border-right: 2px solid white; z-index: 10000;
        `;
        document.body.appendChild(tabBar);
    }

    // Create tab + viewer
    function createAuroraTab({ id, label, color, fileURL, posLeft, posTop }) {
        const viewer = document.createElement("div");
        viewer.id = `${id}GUI`;
        viewer.style = `
            position: fixed; top: ${posTop}px; left: ${posLeft}px; width: 600px; height: 400px;
            background: #1e1e1e; color: ${color}; padding: 20px;
            font-family: monospace; font-size: 14px;
            border-radius: 12px; box-shadow: 0 0 20px ${color};
            overflow: auto; white-space: pre-wrap; z-index: 9998;
            display: none;
        `;
        document.body.appendChild(viewer);
        makeDraggable(viewer);

        const tabBtn = document.createElement("button");
        tabBtn.textContent = label;
        tabBtn.style = `
            display: block; width: 60px; margin: 10px auto;
            padding: 10px; font-size: 14px;
            background: ${color}; color: #000;
            border-radius: 10px; border: none;
            font-family: 'Comfortaa', cursive;
            cursor: pointer; box-shadow: 0 0 8px ${color};
        `;
        tabBtn.onclick = () => {
            if (viewer.style.display === "none") {
                viewer.textContent = `üîÑ Initializing ${label}...`;
                viewer.style.display = "block";

                fetch(fileURL)
                    .then(res => res.ok ? res.text() : Promise.reject("Failed to load"))
                    .then(code => viewer.textContent = code)
                    .catch(err => viewer.textContent = `‚ùå Error loading code: ${err}`);
            } else {
                viewer.style.display = "none";
            }
        };

        tabBar.appendChild(tabBtn);
    }

    // Tabs
    createAuroraTab({
        id: "disk", label: "üíæ disk", color: "#ff77e9",
        fileURL: "https://raw.githubusercontent.com/mixishere/The-Mix-Archive/main/disk",
        posLeft: 100, posTop: 100
    });

    createAuroraTab({
        id: "labs", label: "üß™ labs", color: "#cc66ff",
        fileURL: "https://raw.githubusercontent.com/mixishere/The-Mix-Archive/main/labs",
        posLeft: 100, posTop: 550
    });

    createAuroraTab({
        id: "clickr", label: "üéÆ clickr", color: "#00ffff",
        fileURL: "https://raw.githubusercontent.com/mixishere/The-Mix-Archive/main/clickr",
        posLeft: 750, posTop: 100
    });

    createAuroraTab({
        id: "console", label: "üß† console", color: "#00ff88",
        fileURL: "https://raw.githubusercontent.com/mixishere/The-Mix-Archive/main/console",
        posLeft: 1400, posTop: 100
    });

    createAuroraTab({
        id: "dread", label: "üñ§ dread", color: "#ff4444",
        fileURL: "https://raw.githubusercontent.com/mixishere/The-Mix-Archive/main/dread",
        posLeft: 2100, posTop: 100
    });
})();
